
## Buffer Manager的结构分析

当一个进程访问

```c

typedef struct buftag
{
        RelFileNode rnode;                      /* physical relation identifier */
        ForkNumber      forkNum;
        BlockNumber blockNum;           /* blknum relative to begin of reln */
} BufferTag;

```
typedef struct BufferDesc
{
        BufferTag       tag;                    /* ID of page contained in buffer */
        int                     buf_id;                 /* buffer's index number (from 0) */

        /* state of the tag, containing flags, refcount and usagecount */
        pg_atomic_uint32 state;

        int                     wait_backend_pgprocno;  /* backend of pin-count waiter */
        int                     freeNext;               /* link in freelist chain */
        LWLock          content_lock;   /* to lock access to buffer contents */
} BufferDesc;

#define BUFFERDESC_PAD_TO_SIZE  (SIZEOF_VOID_P == 8 ? 64 : 1)

typedef union BufferDescPadded
{
        BufferDesc      bufferdesc;
        char            pad[BUFFERDESC_PAD_TO_SIZE];
} BufferDescPadded;

```c
```

```c
```

```c
```
