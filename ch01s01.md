## PostgreSQL的体系架构概览

在完成了第一节PostgreSQL的源码编译安装，数据库的启停，初步使用体验之后，我们要对PostgreSQL的体系结构做一个整体的概述，使得读者心中有一副完整的地图，方便后面的深入学习。简而言之，任何数据库都离不开三大件：文件，内存和进程。PostgreSQL也不例外。这里面有三个概念，文件和内存，读者都应该比较熟悉，进程的概念可能有些读者就不大清楚了。下面我们会对这几个概念进行一些剖析。

PostgreSQL的整体结构，可以用下图来表示：

![](d0015.svg)

当我们执行例如"pg_ctl start"的命令启动PostgreSQL的时候，运行的程序是$PGHOME/bin/postgres这个可执行文件。它运行起来的进程叫做postmaster，是第一个进程，也称为“主进程”。postmaster会首先完成一些初始化的工作，最重要的步骤之一就是创建一块大的共享内存。紧接着postgres会通过fork()这个系统调用创建一系列的子进程。这些子进程被称为“后台”进程(backend process)。在完成各种工作之后，postmaster会监听某一个端口(缺省是5432)。当某一个客户端程序打算连接到PostgreSQL进行数据的增删改查操作的时候，它首先用PostgreSQL服务器的IP地址和监听端口号和postmaster进程建立一个TCP连接。如果这个客户有正确的口令，postmaster就会再通过fork()系统调用创建一个服务进程(server process)，这个服务进程将一对一和客户端的进程建立TCP连接，并为其服务。下面我们结合上图依次来介绍PostgreSQL的进程，内存和文件。

### PostgreSQL的后台进程

下面我们依次来介绍进程，内存和磁盘文件。

### PostgreSQL的内存结构

下面我们依次来介绍进程，内存和磁盘文件。

### 数据库集群(Database Cluster)

下面我们依次来介绍进程，内存和磁盘文件。

