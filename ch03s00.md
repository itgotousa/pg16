# 第三章 - 数据文件的页面分析

参考Link:
https://zhmin.github.io/posts/postgresql-buffer-page/


一个Page大小通常为8Kb，也就是8192个字节。我们可以把整个Page划分为四个区域：
- Page头部区域
- 数据指针区域
- 数据区域
- 特殊区域

如下图所示意：

![d0001](https://github.com/itgotousa/pg16/blob/main/d0004.svg)

其中数据指针区域和数据区域是空间共享的，数据指针区域的区间是从上面开始的，向下扩展。而数据区域的空间方向是相反的，从下面开始的，向上扩展。

每条数据存储在 page 里，都对应一个数据指针和一个数据，数据指针记录了实际存储数据的位置。这种共享机制能够充分的利用空间，无论每条数据的是否过大或过小，都能几乎填满整个 page。


### Page头部

```c
typedef struct PageHeaderData
{
	PageXLogRecPtr pd_lsn;	// 该数据页最后一次被修改对应的wal日志的位置
	uint16		pd_checksum;	// 校检值
	uint16		pd_flags;	// 标记位
	LocationIndex pd_lower;	// 空闲空间的起始偏移量
	LocationIndex pd_upper;	// 空闲空间的结束偏移量
	LocationIndex pd_special;	// 特殊空间的结束偏移量
	uint16		pd_pagesize_version;	// page 格式版本号
	TransactionId pd_prune_xid; /* oldest prunable XID, or zero if none */
	ItemIdData	pd_linp[FLEXIBLE_ARRAY_MEMBER]; // 数据指针数组
} PageHeaderData;
```

整个结构如下图所示：

![d0001](https://github.com/itgotousa/pg16/blob/main/d0005.svg)

